name: Add labels according to Issue title

on:
  workflow_call:
    secrets:
      token:
        description: "Github token"
        required: true
      repo:
        description: "Github repository"
        required: true

jobs:
  add-label-using-github-script:
    runs-on: ubuntu-24.04
    timeout-minutes: 1
    # permissions:
    #   issues: write
    steps:
      - uses: actions/github-script@ed597411d8f924073f98dfc5c65a23a2325f34cd # v8.0.0
        with:
          script: |
            /**
             * @typedef {Object} Label
             * @property {string} regex - æ¤œç´¢æ–‡å­—åˆ—
             * @property {string} label - ãƒ©ãƒ™ãƒ«å
             *
             * TODO: inputs.jsonã®èª­ã¿è¾¼ã¿å½¢å¼ã«å¤‰æ›´ã—ãŸã„
             */
            /** @type {Label[]} */
            const labels = [
              { regex: /fix/, label: 'bugs ðŸž' },
              { regex: /chore/, label: 'chore ðŸ ' },
              { regex: /feat/, label: 'enhancement ðŸš€' },
              { regex: /refactor/, label: 'refactoring ðŸ§°' },
              { regex: /test/, label: 'testing âœ…' },
              { regex: /design/, label: 'design ðŸ—ï¸' },
              { regex: /docs/, label: 'docs âœï¸' },
              { regex: /adr/, label: 'ADR ðŸ¯' },
            ];

            const issueTitle = context.payload.issue.title;
            const labelsToAdd = [];

            labels.forEach(label => {
              if (label.regex.test(issueTitle)) {
                console.log(`Match: ${label.label}`);
                labelsToAdd.push(label.label);
              }
            });

            if (labelsToAdd.length > 0) {
              github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.issue.number,
                labels: labelsToAdd
              });
            }
            console.info(`title: ${issueTitle}, labels: ${labelsToAdd.join(',')}`);
